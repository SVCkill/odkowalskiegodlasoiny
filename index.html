<!DOCTYPE html>
<html lang="pl">
<head>
    <link rel="stylesheet" href="assets/index.css">
    <link rel="icon" type="image/x-icon" href="https://play-lh.googleusercontent.com/_TNbiYKasPy_isTSEg2_UEzVaev4F8fO2lLunsHJ8_Ux2g3OzkSZyzpqvJG1woSj-WD4=w240-h480-rw">
    <title>mObywatel</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no">
</head>
<body>
    <p class="logo_text">siemano obywatelek</p>

    <p class="warning">dla SOINKI WARJACIKA<br>BY KOWALSKII</p>

    <div class="guide_holder">
        <div class="top_holder">
            <p class="guide_title">Instrukcja</p>
            <img class="arrow" src="https://i.imgur.com/aUZmu0W.png">
        </div>
        <div class="guide_text">
            <span style="font-size: 17px; font-weight: 500;">Dla systemu IOS:</span><br>
            <ul>
                <li>Upewnij się, że używasz przeglądarki Safari</li>
                <li>Uzupełnij dane i kliknij wejdź</li>
                <li>Naciśji udostępnij -&gt; Do Ekranu głównego</li>
            </ul>
            <span style="font-size: 17px; font-weight: 500;">Dla systemu Android:</span>
            <ul>
                <li>Upewnij się, że używasz przeglądarki google lub chrome</li>
                <li>Uzupełnij dane i kliknij wejdź</li>
                <li>Naciśji 3 kropki -&gt; Dodaj do ekranu głównego</li>
            </ul>
        </div>
    </div>

    <div class="guide_holder">
        <div class="top_holder">
            <p class="guide_title">INFO OGÓLNE - KLIKNIJ TUTAJ</p>
            <img class="arrow" src="https://i.imgur.com/aUZmu0W.png">
        </div>
        <div class="guide_text">
            <!-- Here will be your text content -->
        </div>
    </div>

    <!-- Image Upload Section -->
    <div class="upload">
        <p class="error">To pole jest wymagane</p>
        <img class="upload_uploaded">
        <div class="upload_uploading"></div>
        <div class="upload_grid">
            <img class="upload_image" src="https://i.imgur.com/vwIQErh.png">
            <p class="upload_text">WKLEJ RYJ</p>
        </div>
    </div>

    <!-- Input Fields -->
    <div class="input_holder">
        <input type="text" id="name" class="input" placeholder="">
        <span class="placeholder">Imię (imiona)</span>
        <p class="error">To pole jest wymagane</p>
    </div>
    <!-- Repeat the input_holder for other fields... -->

    <a class="go">wejdź</a>

    <!-- Discord Link Section -->
    <div class="discord" onclick="location.href = 'https://guns.lol/ykc'">
        <div class="inner_grid">
            <p class="discord_text">DC :https://discord.gg/aGXekCTUSp </p>
        </div>
    </div>

    <script>
        var upload = document.querySelector(".upload");

        var imageInput = document.createElement("input");
        imageInput.type = "file";
        imageInput.accept = ".jpeg,.png,.gif";

        document.querySelectorAll(".input_holder").forEach((element) => {
            var input = element.querySelector(".input");
            input.addEventListener('click', () => {
                element.classList.remove("error_shown");
            });
        });

        upload.addEventListener('click', () => {
            imageInput.click();
        });

        imageInput.addEventListener('change', (event) => {
            upload.classList.remove("upload_loaded");
            upload.classList.add("upload_loading");
            upload.removeAttribute("selected");

            var file = imageInput.files[0];

            if (!file) {
                alert("Nie wybrano pliku!");
                upload.classList.remove("upload_loading");
                return;
            }

            var data = new FormData();
            data.append("image", file);

            fetch('https://api.imgur.com/3/image', {
                method: 'POST',
                headers: {
                    'Authorization': 'Client-ID 4ecc257cbb25ccc'
                },
                body: data
            })
            .then(result => result.json())
            .then(response => {
                if (response.success) {
                    var url = response.data.link;
                    upload.classList.remove("error_shown");
                    upload.setAttribute("selected", url);
                    upload.classList.add("upload_loaded");
                    upload.classList.remove("upload_loading");
                    upload.querySelector(".upload_uploaded").src = url;
                } else {
                    alert("Wystąpił problem z przesyłaniem obrazka.");
                    console.error(response);
                    upload.classList.remove("upload_loading");
                }
            })
            .catch(err => {
                alert("Błąd przy wysyłaniu zdjęcia: " + err.message);
                console.error(err);
                upload.classList.remove("upload_loading");
            });
        });

        document.querySelector(".go").addEventListener('click', () => {
            var empty = [];
            var params = new URLSearchParams();

            if (!upload.hasAttribute("selected")) {
                empty.push(upload);
                upload.classList.add("error_shown");
            } else {
                params.append("image", upload.getAttribute("selected"));
            }

            document.querySelectorAll(".input_holder").forEach((element) => {
                var input = element.querySelector(".input");
                params.append(input.id, input.value);

                if (isEmpty(input.value)) {
                    empty.push(element);
                    element.classList.add("error_shown");
                }
            });

            if (empty.length != 0) {
                empty[0].scrollIntoView({ behavior: "smooth", block: "center" });
            } else {
                forwardToId(params);
            }
        });

        function isEmpty(value) {
            let pattern = /^\s*$/;
            return pattern.test(value);
        }

        function forwardToId(params) {
            // Zakładamy, że masz plik id.html obok index.html
            location.href = "id.html?" + params.toString();
        }

        // Rozwijanie sekcji .guide_holder
        var guides = document.querySelectorAll(".guide_holder");
        guides.forEach(function(guide) {
            guide.addEventListener('click', () => {
                guide.classList.toggle("unfolded");
            });
        });
    </script>

</body>
</html>
